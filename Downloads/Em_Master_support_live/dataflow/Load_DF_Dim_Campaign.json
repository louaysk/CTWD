{
    "name": "Load_DF_Dim_Campaign",
    "properties": {
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "dataset": {
                        "referenceName": "Campaignwitheventname",
                        "type": "DatasetReference"
                    },
                    "name": "source1"
                },
                {
                    "dataset": {
                        "referenceName": "DimEvent",
                        "type": "DatasetReference"
                    },
                    "name": "source2"
                }
            ],
            "sinks": [
                {
                    "dataset": {
                        "referenceName": "Dim_Campaign",
                        "type": "DatasetReference"
                    },
                    "name": "sink1"
                }
            ],
            "transformations": [
                {
                    "name": "lookup1"
                },
                {
                    "name": "select1"
                },
                {
                    "name": "derivedColumn1"
                },
                {
                    "name": "alterRow1"
                }
            ],
            "scriptLines": [
                "source(output(",
                "          EventName as string,",
                "          campaignCategory as string,",
                "          currentStatus as string,",
                "          description as string,",
                "          endAt as date,",
                "          folderId as string,",
                "          id as string,",
                "          isEmailMarketingCampaign as string,",
                "          name as string,",
                "          permissions as string,",
                "          startAt as date,",
                "          type as string,",
                "          updatedAt as timestamp,",
                "          updatedBy as string,",
                "          Instance as string,",
                "          actualCost as string,",
                "          adCampaignId as string,",
                "          budgetedCost as string,",
                "          campaignClassification as string,",
                "          crmId as string,",
                "          firstActivation as string,",
                "          isIncludedInROI as string,",
                "          isSyncedWithCRM as string,",
                "          memberCount as string,",
                "          product as string,",
                "          referenceProduct as string,",
                "          region as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     isolationLevel: 'READ_UNCOMMITTED',",
                "     format: 'table',",
                "     staged: true) ~> source1",
                "source(output(",
                "          Event_ID as integer,",
                "          EventID as string,",
                "          EventName as string,",
                "          ShowName as string,",
                "          ShowName2 as string,",
                "          TypeID as long,",
                "          EventStatus as long,",
                "          EventStartDate as date,",
                "          ShellScheme as decimal(38,2),",
                "          SpecialStands as decimal(38,2),",
                "          OutdoorSpaceOnly as decimal(38,2),",
                "          SpaceOnlyAED as decimal(38,2),",
                "          ShellSchemeSqm as decimal(38,2),",
                "          SponsorshipAED as decimal(38,2),",
                "          CorporateDeck as decimal(38,2),",
                "          EventIDValue as string,",
                "          ClusterName as string,",
                "          Execution_Date as timestamp",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     isolationLevel: 'READ_UNCOMMITTED',",
                "     format: 'table',",
                "     staged: true) ~> source2",
                "source1, source2 lookup(upper(source1@EventName) == upper(source2@EventName),",
                "     multiple: false,",
                "     pickup: 'any',",
                "     broadcast: 'auto')~> lookup1",
                "lookup1 select(mapColumn(",
                "          id,",
                "          name,",
                "          currentStatus,",
                "          description,",
                "          Event_ID,",
                "          endAt,",
                "          folderId,",
                "          isEmailMarketingCampaign,",
                "          startAt,",
                "          updatedAt,",
                "          updatedBy,",
                "          Instance,",
                "          firstActivation,",
                "          campaignCategory",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> select1",
                "select1 derive(Execution_Date = currentUTC(),",
                "          Campaign_Code = id+'_'+Instance) ~> derivedColumn1",
                "derivedColumn1 alterRow(upsertIf(1==1)) ~> alterRow1",
                "alterRow1 sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     input(",
                "          Campaign_ID as integer,",
                "          Event_ID as integer,",
                "          ID as string,",
                "          Name as string,",
                "          Campaign_Code as string,",
                "          Startdate as date,",
                "          Instance as string,",
                "          Enddate as date,",
                "          CampaignCategory as string,",
                "          CurrentStatus as string,",
                "          Description as string,",
                "          FolderId as string,",
                "          EmailMarketingCampaign as string,",
                "          UpdatedAt as timestamp,",
                "          UpdatedBy as string,",
                "          FirstActivation as string,",
                "          Execution_Date as timestamp",
                "     ),",
                "     deletable:false,",
                "     insertable:true,",
                "     updateable:false,",
                "     upsertable:true,",
                "     keys:['Campaign_Code'],",
                "     format: 'table',",
                "     staged: true,",
                "     allowCopyCommand: true,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     errorHandlingOption: 'stopOnFirstError',",
                "     mapColumn(",
                "          Event_ID,",
                "          ID = id,",
                "          Name = name,",
                "          Startdate = startAt,",
                "          Instance,",
                "          Enddate = endAt,",
                "          CampaignCategory = campaignCategory,",
                "          CurrentStatus = currentStatus,",
                "          Description = description,",
                "          FolderId = folderId,",
                "          EmailMarketingCampaign = isEmailMarketingCampaign,",
                "          UpdatedAt = updatedAt,",
                "          UpdatedBy = updatedBy,",
                "          FirstActivation = firstActivation,",
                "          Execution_Date,",
                "          Campaign_Code",
                "     )) ~> sink1"
            ]
        }
    }
}