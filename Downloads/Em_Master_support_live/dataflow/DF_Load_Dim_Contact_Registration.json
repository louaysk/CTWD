{
    "name": "DF_Load_Dim_Contact_Registration",
    "properties": {
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "dataset": {
                        "referenceName": "ODS_Visitors",
                        "type": "DatasetReference"
                    },
                    "name": "source1"
                },
                {
                    "linkedService": {
                        "referenceName": "dwtc-bi-WorkspaceDefaultStorage",
                        "type": "LinkedServiceReference"
                    },
                    "name": "source2"
                },
                {
                    "dataset": {
                        "referenceName": "DimEvent",
                        "type": "DatasetReference"
                    },
                    "name": "DimEvent"
                },
                {
                    "dataset": {
                        "referenceName": "Dim_COUNTRY",
                        "type": "DatasetReference"
                    },
                    "name": "DimCountry"
                }
            ],
            "sinks": [
                {
                    "dataset": {
                        "referenceName": "DIM_CONTACT_REGISTRATION",
                        "type": "DatasetReference"
                    },
                    "name": "sink1"
                }
            ],
            "transformations": [
                {
                    "name": "join1"
                },
                {
                    "name": "join2"
                },
                {
                    "name": "filter2"
                },
                {
                    "name": "filter3"
                },
                {
                    "name": "filter4"
                },
                {
                    "name": "filter5"
                },
                {
                    "name": "filter6"
                },
                {
                    "name": "join3"
                },
                {
                    "name": "join4"
                },
                {
                    "name": "select1"
                },
                {
                    "name": "select2"
                },
                {
                    "name": "select3"
                },
                {
                    "name": "select4"
                },
                {
                    "name": "join5"
                },
                {
                    "name": "select5"
                },
                {
                    "name": "derivedColumn1"
                },
                {
                    "name": "lookup1"
                },
                {
                    "name": "select6"
                },
                {
                    "name": "derivedColumn2"
                },
                {
                    "name": "alterRow1"
                },
                {
                    "name": "lookup2"
                }
            ],
            "scriptLines": [
                "source(output(",
                "          id as string,",
                "          grid as string,",
                "          Index as string,",
                "          EventName as string,",
                "          FileName as string,",
                "          Address_line_1 as string,",
                "          Address_line_2 as string,",
                "          Address_line_3 as string,",
                "          AGE as string,",
                "          {Bill_to-Address_line_1} as string,",
                "          {Bill_to-Address_line_2} as string,",
                "          {Bill_to-Address_line_3} as string,",
                "          {Bill_to-City_of_Company} as string,",
                "          {Bill_to-Company_Name} as string,",
                "          {Bill_to-Country} as string,",
                "          {Bill_to-Designation} as string,",
                "          {Bill_to-First_Name} as string,",
                "          {Bill_to-Last_Name} as string,",
                "          {Bill_to-P.O._Box} as string,",
                "          {Bill_to-Postal_Code} as string,",
                "          Reg_Date as timestamp,",
                "          {Bill_to-State} as string,",
                "          City_of_Company as string,",
                "          Company_Facebook as string,",
                "          Company_Instagram as string,",
                "          Company_Linkedin as string,",
                "          Company_Name as string,",
                "          Company_Snapchat as string,",
                "          Company_Twitter as string,",
                "          Company_Website as string,",
                "          Company_Youtube as string,",
                "          Country as string,",
                "          Data_Source as string,",
                "          Department as string,",
                "          Department_Other as string,",
                "          Designation as string,",
                "          Designation_Level as string,",
                "          Designation_Level_Other as string,",
                "          Email as string,",
                "          Email_1 as string,",
                "          Emirates_ID_Passport_No as string,",
                "          Fax_Number as string,",
                "          First_Name as string,",
                "          Full_Name as string,",
                "          Gender as string,",
                "          Job_Function as string,",
                "          LANGUAGE_COMM as string,",
                "          Last_Name as string,",
                "          Middle_Name as string,",
                "          Mobile_Number as string,",
                "          Mobile_Number_1 as string,",
                "          Nationality as string,",
                "          {P.O_Box} as string,",
                "          Personal_Facebook as string,",
                "          Personal_Instagram as string,",
                "          Personal_LinkedIn as string,",
                "          Personal_Pinterest as string,",
                "          Personal_Snapchat as string,",
                "          Personal_Twitter as string,",
                "          Personal_YouTube as string,",
                "          Phone_Extn as string,",
                "          Phone_Number as string,",
                "          Phone_Number_1 as string,",
                "          Postal_Code as string,",
                "          Prefix as string,",
                "          Region as string,",
                "          Source as string,",
                "          State as string,",
                "          Type_of_Data as string,",
                "          UAE_Resedency_Emirate as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     isolationLevel: 'READ_UNCOMMITTED',",
                "     query: 'SELECT   [Index]+Filename as id,\\nCONVERT(NVARCHAR(16),hashbytes(\\'md5\\',concat(upper(replace(Email,\\' \\',\\'\\')),COALESCE(soundex(replace(First_Name,\\' \\',\\'\\')),\\'NA\\')\\n+COALESCE(soundex(replace(Last_Name,\\' \\',\\'\\')),\\'NA\\')\\n+COALESCE(soundex(replace(Company_Name,\\' \\',\\'\\')),\\'NA\\'))),2) grid\\n,[Index]\\n,[EventName]\\n,[FileName]\\n,[Address_line_1]\\n,[Address_line_2]\\n,[Address_line_3]\\n,[AGE]\\n,[Bill_to-Address_line_1]\\n,[Bill_to-Address_line_2]\\n,[Bill_to-Address_line_3]\\n,[Bill_to-City_of_Company]\\n,[Bill_to-Company_Name]\\n,[Bill_to-Country]\\n,[Bill_to-Designation]\\n,[Bill_to-First_Name]\\n,[Bill_to-Last_Name]\\n,[Bill_to-P.O._Box]\\n,[Bill_to-Postal_Code]\\n     ,CASE \\n        WHEN Reg_Date LIKE \\'%PM%\\' \\n        THEN CONVERT(DATETIME, REPLACE(Reg_Date, \\' PM\\', \\' PM\\'), 103) \\n          WHEN Reg_Date LIKE \\'%AM%\\' \\n        THEN CONVERT(DATETIME, REPLACE(Reg_Date, \\' AM\\', \\' AM\\'), 103) \\n          WHEN Reg_Date LIKE \\'%Z%\\' \\n        THEN CONVERT(DATETIME2, Reg_Date, 127) \\n        ELSE   COALESCE(TRY_CONVERT(DATETIME2, Reg_Date, 103) ,      TRY_CONVERT(DATETIME2, Reg_Date, 127), \\n          TRY_CONVERT(datetime, Reg_Date, 101))\\n    END AS Reg_Date \\n,[Bill_to-State]\\n,[City_of_Company]\\n,[Company_Facebook]\\n,[Company_Instagram]\\n,[Company_Linkedin]\\n,[Company_Name]\\n,[Company_Snapchat]\\n,[Company_Twitter]\\n,[Company_Website]\\n,[Company_Youtube]\\n,[Country]\\n,[Data_Source]\\n,[Department]\\n,[Department_Other]\\n,[Designation]\\n,[Designation_Level]\\n,[Designation_Level_Other]\\n,[Email]\\n,[Email_1]\\n,[Emirates_ID_Passport_No]\\n,[Fax_Number]\\n,[First_Name]\\n,[Full_Name]\\n,[Gender]\\n,[Job_Function]\\n,[LANGUAGE_COMM]\\n,[Last_Name]\\n,[Middle_Name]\\n,[Mobile_Number]\\n,[Mobile_Number_1]\\n,[Nationality]\\n,[P.O_Box]\\n,[Personal_Facebook]\\n,[Personal_Instagram]\\n,[Personal_LinkedIn]\\n,[Personal_Pinterest]\\n,[Personal_Snapchat]\\n,[Personal_Twitter]\\n,[Personal_YouTube]\\n,[Phone_Extn]\\n,[Phone_Number]\\n,[Phone_Number_1]\\n,[Postal_Code]\\n,[Prefix]\\n,[Region]\\n,[Source]\\n,[State]\\n,[Type_of_Data]\\n,[UAE_Resedency_Emirate]\\n  FROM [ods].[EM_Visitors]\\n where ([EventName] <> \\'DO NOT IMPORT\\' or [EventName] is null)\\n and [FileName] NOT IN (\\n  SELECT [FileName]\\n  FROM [EM_DWH].[DEV_CONTACT_REGISTRATION]\\n )\\n  group by \\n  [Index]+Filename ,\\n  CONVERT(NVARCHAR(16),hashbytes(\\'md5\\',concat(upper(replace(Email,\\' \\',\\'\\')),COALESCE(soundex(replace(First_Name,\\' \\',\\'\\')),\\'NA\\')\\n+COALESCE(soundex(replace(Last_Name,\\' \\',\\'\\')),\\'NA\\')\\n+COALESCE(soundex(replace(Company_Name,\\' \\',\\'\\')),\\'NA\\'))),2)\\n,[Index]\\n,[EventName]\\n,[FileName]\\n,[Address_line_1]\\n,[Address_line_2]\\n,[Address_line_3]\\n,[AGE]\\n,[Bill_to-Address_line_1]\\n,[Bill_to-Address_line_2]\\n,[Bill_to-Address_line_3]\\n,[Bill_to-City_of_Company]\\n,[Bill_to-Company_Name]\\n,[Bill_to-Country]\\n,[Bill_to-Designation]\\n,[Bill_to-First_Name]\\n,[Bill_to-Last_Name]\\n,[Bill_to-P.O._Box]\\n,[Bill_to-Postal_Code]\\n,[Bill_to-State]\\n,[City_of_Company]\\n,[Company_Facebook]\\n,[Company_Instagram]\\n,[Company_Linkedin]\\n,[Company_Name]\\n,[Company_Snapchat]\\n,[Company_Twitter]\\n,[Company_Website]\\n,[Company_Youtube]\\n,[Country]\\n,[Data_Source]\\n,[Department]\\n,[Department_Other]\\n,[Designation]\\n,[Designation_Level]\\n,[Designation_Level_Other]\\n,[Email]\\n,[Email_1]\\n,[Emirates_ID_Passport_No]\\n,[Fax_Number]\\n,[First_Name]\\n,[Full_Name]\\n,[Gender]\\n,[Job_Function]\\n,[LANGUAGE_COMM]\\n,[Last_Name]\\n,[Middle_Name]\\n,[Mobile_Number]\\n,[Mobile_Number_1]\\n,[Nationality]\\n,[P.O_Box]\\n,[Personal_Facebook]\\n,[Personal_Instagram]\\n,[Personal_LinkedIn]\\n,[Personal_Pinterest]\\n,[Personal_Snapchat]\\n,[Personal_Twitter]\\n,[Personal_YouTube]\\n,[Phone_Extn]\\n,[Phone_Number]\\n,[Phone_Number_1]\\n,[Postal_Code]\\n,[Prefix]\\n,[Region]\\n,[Source]\\n,     CASE \\n        WHEN Reg_Date LIKE \\'%PM%\\' \\n        THEN CONVERT(DATETIME, REPLACE(Reg_Date, \\' PM\\', \\' PM\\'), 103) \\n          WHEN Reg_Date LIKE \\'%AM%\\' \\n        THEN CONVERT(DATETIME, REPLACE(Reg_Date, \\' AM\\', \\' AM\\'), 103) \\n          WHEN Reg_Date LIKE \\'%Z%\\' \\n        THEN CONVERT(DATETIME2, Reg_Date, 127) \\n        ELSE   COALESCE(TRY_CONVERT(DATETIME2, Reg_Date, 103) ,      TRY_CONVERT(DATETIME2, Reg_Date, 127), \\n          TRY_CONVERT(datetime, Reg_Date, 101))\\n    END\\n,[State]\\n,[Type_of_Data]\\n,[UAE_Resedency_Emirate]',",
                "     format: 'query',",
                "     staged: true) ~> source1",
                "source(output(",
                "          Question as string,",
                "          Answer as string,",
                "          {New Value} as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'excel',",
                "     fileSystem: 'em-data',",
                "     folderPath: 'Input Files',",
                "     fileName: 'Value Mapping - Result.xlsx',",
                "     sheetName: 'NEW',",
                "     firstRowAsHeader: true) ~> source2",
                "source(output(",
                "          Event_ID as integer,",
                "          EventID as string,",
                "          EventName as string,",
                "          ShowName as string,",
                "          ShowName2 as string,",
                "          TypeID as long,",
                "          EventStatus as long,",
                "          EventStartDate as date,",
                "          ShellScheme as decimal(38,2),",
                "          SpecialStands as decimal(38,2),",
                "          OutdoorSpaceOnly as decimal(38,2),",
                "          SpaceOnlyAED as decimal(38,2),",
                "          ShellSchemeSqm as decimal(38,2),",
                "          SponsorshipAED as decimal(38,2),",
                "          CorporateDeck as decimal(38,2),",
                "          EventIDValue as string,",
                "          ClusterName as string,",
                "          Execution_Date as timestamp",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     isolationLevel: 'READ_UNCOMMITTED',",
                "     format: 'table',",
                "     staged: true) ~> DimEvent",
                "source(output(",
                "          Country_ID as integer,",
                "          Country as string,",
                "          Country_Question_DomainID as string,",
                "          Country_AnswerDomainID as string,",
                "          {UAID-Country} as string,",
                "          Country_Code as string,",
                "          DWTC_region as string,",
                "          {UAID-Region} as string,",
                "          RegionDomainID as string,",
                "          {UAID-Nationality} as string,",
                "          NationalityDomainID as string,",
                "          NationalityNew as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     isolationLevel: 'READ_UNCOMMITTED',",
                "     format: 'table',",
                "     staged: true) ~> DimCountry",
                "source1, filter6 join(upper(Country) == upper(Answer),",
                "     joinType:'left',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> join1",
                "select1, filter5 join(upper(Job_Function) == upper(Answer),",
                "     joinType:'left',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> join2",
                "source2 filter(Question=='Department') ~> filter2",
                "source2 filter(Question=='Designation_Level') ~> filter3",
                "source2 filter(Question=='Gender') ~> filter4",
                "source2 filter(Question=='Job_Function') ~> filter5",
                "source2 filter(Question=='Country') ~> filter6",
                "select2, filter4 join(upper(Gender) == upper(Answer),",
                "     joinType:'left',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> join3",
                "select3, filter2 join(upper(Department) == upper(Answer),",
                "     joinType:'left',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> join4",
                "join1 select(mapColumn(",
                "          id,",
                "          Index,",
                "          EventName,",
                "          FileName,",
                "          Address_line_1,",
                "          Address_line_2,",
                "          Address_line_3,",
                "          AGE,",
                "          {Bill_to-Address_line_1},",
                "          {Bill_to-Address_line_2},",
                "          {Bill_to-Address_line_3},",
                "          {Bill_to-City_of_Company},",
                "          {Bill_to-Company_Name},",
                "          {Bill_to-Country},",
                "          {Bill_to-Designation},",
                "          {Bill_to-First_Name},",
                "          {Bill_to-Last_Name},",
                "          {Bill_to-P.O._Box},",
                "          {Bill_to-Postal_Code},",
                "          Reg_Date,",
                "          {Bill_to-State},",
                "          City_of_Company,",
                "          Company_Facebook,",
                "          Company_Instagram,",
                "          Company_Linkedin,",
                "          Company_Name,",
                "          Company_Snapchat,",
                "          Company_Twitter,",
                "          Company_Website,",
                "          Company_Youtube,",
                "          Country,",
                "          Data_Source,",
                "          Department,",
                "          Department_Other,",
                "          Designation,",
                "          Designation_Level,",
                "          Designation_Level_Other,",
                "          Email,",
                "          Email_1,",
                "          Emirates_ID_Passport_No,",
                "          Fax_Number,",
                "          First_Name,",
                "          Full_Name,",
                "          Gender,",
                "          Job_Function,",
                "          LANGUAGE_COMM,",
                "          Last_Name,",
                "          Middle_Name,",
                "          Mobile_Number,",
                "          Mobile_Number_1,",
                "          Nationality,",
                "          {P.O_Box},",
                "          Personal_Facebook,",
                "          Personal_Instagram,",
                "          Personal_LinkedIn,",
                "          Personal_Pinterest,",
                "          Personal_Snapchat,",
                "          Personal_Twitter,",
                "          Personal_YouTube,",
                "          Phone_Extn,",
                "          Phone_Number,",
                "          Phone_Number_1,",
                "          Postal_Code,",
                "          Prefix,",
                "          Region,",
                "          Source,",
                "          State,",
                "          Type_of_Data,",
                "          UAE_Resedency_Emirate,",
                "          Country1 = {New Value},",
                "          grid",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> select1",
                "join2 select(mapColumn(",
                "          id,",
                "          Index,",
                "          EventName,",
                "          FileName,",
                "          Address_line_1,",
                "          Address_line_2,",
                "          Address_line_3,",
                "          AGE,",
                "          {Bill_to-Address_line_1},",
                "          {Bill_to-Address_line_2},",
                "          {Bill_to-Address_line_3},",
                "          {Bill_to-City_of_Company},",
                "          {Bill_to-Company_Name},",
                "          {Bill_to-Country},",
                "          {Bill_to-Designation},",
                "          {Bill_to-First_Name},",
                "          {Bill_to-Last_Name},",
                "          {Bill_to-P.O._Box},",
                "          {Bill_to-Postal_Code},",
                "          {Bill_to-State},",
                "          City_of_Company,",
                "          Company_Facebook,",
                "          Company_Instagram,",
                "          Company_Linkedin,",
                "          Company_Name,",
                "          Company_Snapchat,",
                "          Company_Twitter,",
                "          Company_Website,",
                "          Company_Youtube,",
                "          Country,",
                "          Data_Source,",
                "          Department,",
                "          Department_Other,",
                "          Designation,",
                "          Designation_Level,",
                "          Designation_Level_Other,",
                "          Email,",
                "          Email_1,",
                "          Emirates_ID_Passport_No,",
                "          Fax_Number,",
                "          First_Name,",
                "          Full_Name,",
                "          Gender,",
                "          Job_Function,",
                "          LANGUAGE_COMM,",
                "          Last_Name,",
                "          Middle_Name,",
                "          Mobile_Number,",
                "          Mobile_Number_1,",
                "          Nationality,",
                "          {P.O_Box},",
                "          Personal_Facebook,",
                "          Personal_Instagram,",
                "          Personal_LinkedIn,",
                "          Personal_Pinterest,",
                "          Personal_Snapchat,",
                "          Personal_Twitter,",
                "          Personal_YouTube,",
                "          Phone_Extn,",
                "          Phone_Number,",
                "          Phone_Number_1,",
                "          Postal_Code,",
                "          Prefix,",
                "          Region,",
                "          Source,",
                "          State,",
                "          Type_of_Data,",
                "          UAE_Resedency_Emirate,",
                "          Country1,",
                "          Job_Function1 = {New Value},",
                "          Reg_Date,",
                "          grid",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> select2",
                "join3 select(mapColumn(",
                "          id,",
                "          Index,",
                "          EventName,",
                "          FileName,",
                "          Address_line_1,",
                "          Address_line_2,",
                "          Address_line_3,",
                "          AGE,",
                "          {Bill_to-Address_line_1},",
                "          {Bill_to-Address_line_2},",
                "          {Bill_to-Address_line_3},",
                "          {Bill_to-City_of_Company},",
                "          {Bill_to-Company_Name},",
                "          {Bill_to-Country},",
                "          {Bill_to-Designation},",
                "          {Bill_to-First_Name},",
                "          {Bill_to-Last_Name},",
                "          {Bill_to-P.O._Box},",
                "          {Bill_to-Postal_Code},",
                "          Reg_Date,",
                "          {Bill_to-State},",
                "          City_of_Company,",
                "          Company_Facebook,",
                "          Company_Instagram,",
                "          Company_Linkedin,",
                "          Company_Name,",
                "          Company_Snapchat,",
                "          Company_Twitter,",
                "          Company_Website,",
                "          Company_Youtube,",
                "          Country,",
                "          Data_Source,",
                "          Department,",
                "          Department_Other,",
                "          Designation,",
                "          Designation_Level,",
                "          Designation_Level_Other,",
                "          Email,",
                "          Email_1,",
                "          Emirates_ID_Passport_No,",
                "          Fax_Number,",
                "          First_Name,",
                "          Full_Name,",
                "          Gender,",
                "          Job_Function,",
                "          LANGUAGE_COMM,",
                "          Last_Name,",
                "          Middle_Name,",
                "          Mobile_Number,",
                "          Mobile_Number_1,",
                "          Nationality,",
                "          {P.O_Box},",
                "          Personal_Facebook,",
                "          Personal_Instagram,",
                "          Personal_LinkedIn,",
                "          Personal_Pinterest,",
                "          Personal_Snapchat,",
                "          Personal_Twitter,",
                "          Personal_YouTube,",
                "          Phone_Extn,",
                "          Phone_Number,",
                "          Phone_Number_1,",
                "          Postal_Code,",
                "          Prefix,",
                "          Region,",
                "          Source,",
                "          State,",
                "          Type_of_Data,",
                "          UAE_Resedency_Emirate,",
                "          Country1,",
                "          Job_Function1,",
                "          Gender1 = {New Value},",
                "          grid",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> select3",
                "join4 select(mapColumn(",
                "          id,",
                "          Index,",
                "          EventName,",
                "          FileName,",
                "          Address_line_1,",
                "          Address_line_2,",
                "          Address_line_3,",
                "          AGE,",
                "          {Bill_to-Address_line_1},",
                "          {Bill_to-Address_line_2},",
                "          {Bill_to-Address_line_3},",
                "          {Bill_to-City_of_Company},",
                "          {Bill_to-Company_Name},",
                "          {Bill_to-Country},",
                "          {Bill_to-Designation},",
                "          {Bill_to-First_Name},",
                "          {Bill_to-Last_Name},",
                "          {Bill_to-P.O._Box},",
                "          {Bill_to-Postal_Code},",
                "          Reg_Date,",
                "          {Bill_to-State},",
                "          City_of_Company,",
                "          Company_Facebook,",
                "          Company_Instagram,",
                "          Company_Linkedin,",
                "          Company_Name,",
                "          Company_Snapchat,",
                "          Company_Twitter,",
                "          Company_Website,",
                "          Company_Youtube,",
                "          Country,",
                "          Data_Source,",
                "          Department,",
                "          Department_Other,",
                "          Designation,",
                "          Designation_Level,",
                "          Designation_Level_Other,",
                "          Email,",
                "          Email_1,",
                "          Emirates_ID_Passport_No,",
                "          Fax_Number,",
                "          First_Name,",
                "          Full_Name,",
                "          Gender,",
                "          Job_Function,",
                "          LANGUAGE_COMM,",
                "          Last_Name,",
                "          Middle_Name,",
                "          Mobile_Number,",
                "          Mobile_Number_1,",
                "          Nationality,",
                "          {P.O_Box},",
                "          Personal_Facebook,",
                "          Personal_Instagram,",
                "          Personal_LinkedIn,",
                "          Personal_Pinterest,",
                "          Personal_Snapchat,",
                "          Personal_Twitter,",
                "          Personal_YouTube,",
                "          Phone_Extn,",
                "          Phone_Number,",
                "          Phone_Number_1,",
                "          Postal_Code,",
                "          Prefix,",
                "          Region,",
                "          Source,",
                "          State,",
                "          Type_of_Data,",
                "          UAE_Resedency_Emirate,",
                "          Country1,",
                "          Job_Function1,",
                "          Gender1,",
                "          Department1 = {New Value},",
                "          grid",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> select4",
                "select4, filter3 join(upper(Designation_Level) == upper(Answer),",
                "     joinType:'left',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> join5",
                "join5 select(mapColumn(",
                "          id,",
                "          Index,",
                "          EventName,",
                "          FileName,",
                "          Address_line_1,",
                "          Address_line_2,",
                "          Address_line_3,",
                "          AGE,",
                "          {Bill_to-Address_line_1},",
                "          {Bill_to-Address_line_2},",
                "          {Bill_to-Address_line_3},",
                "          {Bill_to-City_of_Company},",
                "          {Bill_to-Company_Name},",
                "          {Bill_to-Country},",
                "          {Bill_to-Designation},",
                "          {Bill_to-First_Name},",
                "          {Bill_to-Last_Name},",
                "          {Bill_to-P.O._Box},",
                "          {Bill_to-Postal_Code},",
                "          Reg_Date,",
                "          {Bill_to-State},",
                "          City_of_Company,",
                "          Company_Facebook,",
                "          Company_Instagram,",
                "          Company_Linkedin,",
                "          Company_Name,",
                "          Company_Snapchat,",
                "          Company_Twitter,",
                "          Company_Website,",
                "          Company_Youtube,",
                "          Country,",
                "          Data_Source,",
                "          Department,",
                "          Department_Other,",
                "          Designation,",
                "          Designation_Level,",
                "          Designation_Level_Other,",
                "          Email,",
                "          Email_1,",
                "          Emirates_ID_Passport_No,",
                "          Fax_Number,",
                "          First_Name,",
                "          Full_Name,",
                "          Gender,",
                "          Job_Function,",
                "          LANGUAGE_COMM,",
                "          Last_Name,",
                "          Middle_Name,",
                "          Mobile_Number,",
                "          Mobile_Number_1,",
                "          Nationality,",
                "          {P.O_Box},",
                "          Personal_Facebook,",
                "          Personal_Instagram,",
                "          Personal_LinkedIn,",
                "          Personal_Pinterest,",
                "          Personal_Snapchat,",
                "          Personal_Twitter,",
                "          Personal_YouTube,",
                "          Phone_Extn,",
                "          Phone_Number,",
                "          Phone_Number_1,",
                "          Postal_Code,",
                "          Prefix,",
                "          Region,",
                "          Source,",
                "          State,",
                "          Type_of_Data,",
                "          UAE_Resedency_Emirate,",
                "          Country1,",
                "          Job_Function1,",
                "          Gender1,",
                "          Department1,",
                "          DesignationLevel1 = {New Value},",
                "          grid",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> select5",
                "select5 derive(Designation_Level = iifNull(DesignationLevel1, Designation_Level,DesignationLevel1),",
                "          Department = iifNull(Department1, Department,Department1),",
                "          Country = iifNull(Country1, Country,Country1),",
                "          Job_Function = iifNull(Job_Function1, Job_Function,Job_Function1),",
                "          Gender = iifNull(Gender1, Gender,Gender1)) ~> derivedColumn1",
                "derivedColumn1, DimEvent lookup(upper(select5@EventName) == upper(DimEvent@EventName),",
                "     multiple: false,",
                "     pickup: 'any',",
                "     broadcast: 'auto')~> lookup1",
                "lookup1 select(mapColumn(",
                "          id,",
                "          Index,",
                "          Event_ID,",
                "          FileName,",
                "          Address_line_1,",
                "          Address_line_2,",
                "          Address_line_3,",
                "          AGE,",
                "          {Bill_to-Address_line_1},",
                "          {Bill_to-Address_line_2},",
                "          {Bill_to-Address_line_3},",
                "          {Bill_to-City_of_Company},",
                "          {Bill_to-Company_Name},",
                "          {Bill_to-Country},",
                "          {Bill_to-Designation},",
                "          {Bill_to-First_Name},",
                "          {Bill_to-Last_Name},",
                "          {Bill_to-P.O._Box},",
                "          {Bill_to-Postal_Code},",
                "          Reg_Date,",
                "          {Bill_to-State},",
                "          City_of_Company,",
                "          Company_Facebook,",
                "          Company_Instagram,",
                "          Company_Linkedin,",
                "          Company_Name,",
                "          Company_Snapchat,",
                "          Company_Twitter,",
                "          Company_Website,",
                "          Company_Youtube,",
                "          Country,",
                "          Data_Source,",
                "          Department,",
                "          Department_Other,",
                "          Designation,",
                "          Designation_Level,",
                "          Designation_Level_Other,",
                "          Email,",
                "          Email_1,",
                "          Emirates_ID_Passport_No,",
                "          Fax_Number,",
                "          First_Name,",
                "          Full_Name,",
                "          Gender,",
                "          Job_Function,",
                "          LANGUAGE_COMM,",
                "          Last_Name,",
                "          Middle_Name,",
                "          Mobile_Number,",
                "          Mobile_Number_1,",
                "          Nationality,",
                "          {P.O_Box},",
                "          Personal_Facebook,",
                "          Personal_Instagram,",
                "          Personal_LinkedIn,",
                "          Personal_Pinterest,",
                "          Personal_Snapchat,",
                "          Personal_Twitter,",
                "          Personal_YouTube,",
                "          Phone_Extn,",
                "          Phone_Number,",
                "          Phone_Number_1,",
                "          Postal_Code,",
                "          Prefix,",
                "          Region,",
                "          Source,",
                "          State,",
                "          Type_of_Data,",
                "          UAE_Resedency_Emirate,",
                "          Country,",
                "          EventStartDate,",
                "          grid",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> select6",
                "select6 derive(Reg_Date = iifNull(Reg_Date, EventStartDate,Reg_Date),",
                "          Execution_Date = currentUTC()) ~> derivedColumn2",
                "lookup2 alterRow(upsertIf(1==1)) ~> alterRow1",
                "derivedColumn2, DimCountry lookup(upper(select6@Country) == upper(DimCountry@Country),",
                "     multiple: false,",
                "     pickup: 'any',",
                "     broadcast: 'auto')~> lookup2",
                "alterRow1 sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     input(",
                "          Contact_ID as integer,",
                "          ID as string,",
                "          Index as string,",
                "          Event_ID as integer,",
                "          Country_ID as integer,",
                "          FileName as string,",
                "          Address_line_1 as string,",
                "          Address_line_2 as string,",
                "          Address_line_3 as string,",
                "          AGE as string,",
                "          {Bill_to-Address_line_1} as string,",
                "          {Bill_to-Address_line_2} as string,",
                "          {Bill_to-Address_line_3} as string,",
                "          {Bill_to-City_of_Company} as string,",
                "          {Bill_to-Company_Name} as string,",
                "          {Bill_to-Country} as string,",
                "          {Bill_to-Designation} as string,",
                "          {Bill_to-First_Name} as string,",
                "          {Bill_to-Last_Name} as string,",
                "          {Bill_to-P.O._Box} as string,",
                "          {Bill_to-Postal_Code} as string,",
                "          {Bill_to-State} as string,",
                "          City_of_Company as string,",
                "          Company_Facebook as string,",
                "          Company_Instagram as string,",
                "          Company_Linkedin as string,",
                "          CompanyName as string,",
                "          Company_Snapchat as string,",
                "          Company_Twitter as string,",
                "          Company_Website as string,",
                "          Company_Youtube as string,",
                "          Country as string,",
                "          Data_Source as string,",
                "          Department as string,",
                "          Department_Other as string,",
                "          Designation as string,",
                "          {[DesignationLevel]} as string,",
                "          Designation_Level_Other as string,",
                "          Email as string,",
                "          Email_1 as string,",
                "          Emirates_ID_Passport_No as string,",
                "          Fax_Number as string,",
                "          FirstName as string,",
                "          FullName as string,",
                "          Gender as string,",
                "          JobFunction as string,",
                "          LANGUAGE_COMM as string,",
                "          LastName as string,",
                "          Middle_Name as string,",
                "          MobilePhone as string,",
                "          MobilePhone2 as string,",
                "          Nationality as string,",
                "          {P.O_Box} as string,",
                "          Personal_Facebook as string,",
                "          Personal_Instagram as string,",
                "          Personal_LinkedIn as string,",
                "          Personal_Pinterest as string,",
                "          Personal_Snapchat as string,",
                "          Personal_Twitter as string,",
                "          Personal_YouTube as string,",
                "          Phone_Extn as string,",
                "          PhoneNumber1 as string,",
                "          PhoneNumber2 as string,",
                "          Postal_Code as string,",
                "          Prefix as string,",
                "          Region as string,",
                "          Source as string,",
                "          State as string,",
                "          Type_of_Data as string,",
                "          UAE_Resedency_Emirate as string,",
                "          Reg_Date as timestamp,",
                "          Contact_GR_ID as integer,",
                "          Execution_Date as timestamp,",
                "          DesignationLevel as string,",
                "          GR_ID as string",
                "     ),",
                "     deletable:false,",
                "     insertable:true,",
                "     updateable:false,",
                "     upsertable:true,",
                "     keys:['ID'],",
                "     format: 'table',",
                "     staged: true,",
                "     allowCopyCommand: true,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     errorHandlingOption: 'stopOnFirstError',",
                "     mapColumn(",
                "          ID = id,",
                "          Index,",
                "          Event_ID,",
                "          Country_ID,",
                "          FileName,",
                "          Address_line_1,",
                "          Address_line_2,",
                "          Address_line_3,",
                "          AGE,",
                "          {Bill_to-Address_line_1},",
                "          {Bill_to-Address_line_2},",
                "          {Bill_to-Address_line_3},",
                "          {Bill_to-City_of_Company},",
                "          {Bill_to-Company_Name},",
                "          {Bill_to-Country},",
                "          {Bill_to-Designation},",
                "          {Bill_to-First_Name},",
                "          {Bill_to-Last_Name},",
                "          {Bill_to-P.O._Box},",
                "          {Bill_to-Postal_Code},",
                "          {Bill_to-State},",
                "          City_of_Company,",
                "          Company_Facebook,",
                "          Company_Instagram,",
                "          Company_Linkedin,",
                "          CompanyName = Company_Name,",
                "          Company_Snapchat,",
                "          Company_Twitter,",
                "          Company_Website,",
                "          Company_Youtube,",
                "          Data_Source,",
                "          Department,",
                "          Department_Other,",
                "          Designation,",
                "          DesignationLevel = Designation_Level,",
                "          Designation_Level_Other,",
                "          Email,",
                "          Email_1,",
                "          Emirates_ID_Passport_No,",
                "          Fax_Number,",
                "          FirstName = First_Name,",
                "          FullName = Full_Name,",
                "          Gender,",
                "          JobFunction = Job_Function,",
                "          LANGUAGE_COMM,",
                "          LastName = Last_Name,",
                "          Middle_Name,",
                "          MobilePhone = Mobile_Number,",
                "          MobilePhone2 = Mobile_Number_1,",
                "          Nationality,",
                "          {P.O_Box},",
                "          Personal_Facebook,",
                "          Personal_Instagram,",
                "          Personal_LinkedIn,",
                "          Personal_Pinterest,",
                "          Personal_Snapchat,",
                "          Personal_Twitter,",
                "          Personal_YouTube,",
                "          Phone_Extn,",
                "          PhoneNumber1 = Phone_Number,",
                "          PhoneNumber2 = Phone_Number_1,",
                "          Postal_Code,",
                "          Prefix,",
                "          Region,",
                "          Source,",
                "          State,",
                "          Type_of_Data,",
                "          UAE_Resedency_Emirate,",
                "          Country = DimCountry@Country,",
                "          Reg_Date,",
                "          Execution_Date,",
                "          GR_ID = grid",
                "     )) ~> sink1"
            ]
        }
    }
}