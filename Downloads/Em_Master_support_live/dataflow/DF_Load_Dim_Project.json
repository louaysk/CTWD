{
    "name": "DF_Load_Dim_Project",
    "properties": {
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "dataset": {
                        "referenceName": "ODS_RESEARCH_PROJECT",
                        "type": "DatasetReference"
                    },
                    "name": "source1"
                },
                {
                    "dataset": {
                        "referenceName": "DimEvent",
                        "type": "DatasetReference"
                    },
                    "name": "DimEvent"
                }
            ],
            "sinks": [
                {
                    "dataset": {
                        "referenceName": "DIM_PROJECTS",
                        "type": "DatasetReference"
                    },
                    "name": "sink1"
                }
            ],
            "transformations": [
                {
                    "name": "derivedColumn1"
                },
                {
                    "name": "alterRow1"
                },
                {
                    "name": "lookup1"
                }
            ],
            "scriptLines": [
                "source(output(",
                "          Research_ID as string,",
                "          Cluster as string,",
                "          Show as string,",
                "          Edition as string,",
                "          Project_Name as string,",
                "          Target_Audience as string,",
                "          Research_Type as string,",
                "          Data_Source as string,",
                "          Requested_By as string,",
                "          Project_Type as string,",
                "          Requested_Date as date,",
                "          Status as string,",
                "          Completion_Date as date,",
                "          Estimated_Records as string,",
                "          Total_Records_Received as decimal(38,2),",
                "          Research_Conducted_By as string,",
                "          PR_Number as string,",
                "          PO_Number as string,",
                "          Invoice_Number as string,",
                "          Quoted_Amount as decimal(38,2),",
                "          Invoiced_Amount as decimal(38,2),",
                "          VAT as decimal(38,2),",
                "          Total_Invoiced_Amount as decimal(38,2),",
                "          Currency as string,",
                "          Payment_Status as string,",
                "          Comments as string,",
                "          Execution_Date as timestamp",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     isolationLevel: 'READ_UNCOMMITTED',",
                "     format: 'table',",
                "     staged: true) ~> source1",
                "source(output(",
                "          Event_ID as integer,",
                "          EventID as string,",
                "          EventName as string,",
                "          ShowName as string,",
                "          ShowName2 as string,",
                "          TypeID as long,",
                "          EventStatus as long,",
                "          EventStartDate as date,",
                "          ShellScheme as decimal(38,2),",
                "          SpecialStands as decimal(38,2),",
                "          OutdoorSpaceOnly as decimal(38,2),",
                "          SpaceOnlyAED as decimal(38,2),",
                "          ShellSchemeSqm as decimal(38,2),",
                "          SponsorshipAED as decimal(38,2),",
                "          CorporateDeck as decimal(38,2),",
                "          EventIDValue as string,",
                "          ClusterName as string,",
                "          Execution_Date as timestamp",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     isolationLevel: 'READ_UNCOMMITTED',",
                "     format: 'table',",
                "     staged: true) ~> DimEvent",
                "source1 derive(Execution_Date = currentDate(),",
                "          EventName = Show+\" \"+Edition) ~> derivedColumn1",
                "lookup1 alterRow(upsertIf(1==1)) ~> alterRow1",
                "derivedColumn1, DimEvent lookup(upper(derivedColumn1@EventName) == upper(DimEvent@EventName),",
                "     multiple: false,",
                "     pickup: 'any',",
                "     broadcast: 'auto')~> lookup1",
                "alterRow1 sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     input(",
                "          Research_ID as integer,",
                "          Research_Code as string,",
                "          Cluster as string,",
                "          Show as string,",
                "          Edition as string,",
                "          Project_Name as string,",
                "          Target_Audience as string,",
                "          Research_Type as string,",
                "          Data_Source as string,",
                "          Requested_By as string,",
                "          Project_Type as string,",
                "          Requested_Date as date,",
                "          Status as string,",
                "          Completion_Date as date,",
                "          Estimated_Records as string,",
                "          Total_Records_Received as decimal(38,2),",
                "          Research_Conducted_By as string,",
                "          PR_Number as string,",
                "          PO_Number as string,",
                "          Invoice_Number as string,",
                "          Quoted_Amount as decimal(38,2),",
                "          Invoiced_Amount as decimal(38,2),",
                "          VAT as decimal(38,2),",
                "          Total_Invoiced_Amount as decimal(38,2),",
                "          Currency as string,",
                "          Payment_Status as string,",
                "          Comments as string,",
                "          Execution_Date as timestamp,",
                "          Event_ID as integer",
                "     ),",
                "     deletable:false,",
                "     insertable:true,",
                "     updateable:false,",
                "     upsertable:true,",
                "     keys:['Research_Code'],",
                "     format: 'table',",
                "     staged: true,",
                "     allowCopyCommand: true,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     errorHandlingOption: 'stopOnFirstError',",
                "     mapColumn(",
                "          Research_Code = Research_ID,",
                "          Event_ID,",
                "          Cluster,",
                "          Show,",
                "          Edition,",
                "          Project_Name,",
                "          Target_Audience,",
                "          Research_Type,",
                "          Data_Source,",
                "          Requested_By,",
                "          Research_Conducted_By,",
                "          Project_Type,",
                "          Requested_Date,",
                "          Status,",
                "          Completion_Date,",
                "          Estimated_Records,",
                "          Total_Records_Received,",
                "          PR_Number,",
                "          PO_Number,",
                "          Invoice_Number,",
                "          Quoted_Amount,",
                "          Invoiced_Amount,",
                "          VAT,",
                "          Total_Invoiced_Amount,",
                "          Currency,",
                "          Payment_Status,",
                "          Comments,",
                "          Execution_Date",
                "     )) ~> sink1"
            ]
        }
    }
}